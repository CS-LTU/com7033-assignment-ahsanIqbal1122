{% extends "base.html" %}
{% block content %}

<style>
  #cy {
    width: 100%;
    height: 600px;
    background: #f5f5f5;
    border-radius: 8px;
    border: 1px solid #ddd;
  }
  .graph-container {
    margin: 20px 0;
  }
</style>

<h3 class="mb-3">Stroke Patients by Smoking Status â€” Relational Graph</h3>

<div class="row">
  <div class="col-md-8">
    <div class="graph-container">
      <div id="cy"></div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Statistics</h5>
        <p><strong>Total Stroke Patients:</strong> {{ stats['total_stroke'] }}</p>
        <hr>
        <h6>By Smoking Status:</h6>
        <ul class="list-group list-group-flush">
          {% for status, count in stats['by_smoking'].items() %}
            <li class="list-group-item d-flex justify-content-between">
              <span>{{ status.capitalize() }}</span>
              <span class="badge bg-primary">{{ count }}</span>
            </li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>
</div>

<a href="{{ url_for('dashboard.doctor_dashboard') }}" class="btn btn-outline-secondary mt-3">Back</a>

<!-- Cytoscape.js library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.20.0/cytoscape.min.js"></script>

<script>
  const nodes = {{ nodes | tojson | safe }};
  const edges = {{ edges | tojson | safe }};

  const cy = cytoscape({
    container: document.getElementById('cy'),
    elements: nodes.concat(edges),
    style: [
      {
        selector: 'node',
        style: {
          'content': 'data(label)',
          'text-valign': 'center',
          'text-halign': 'center',
          'font-size': 12,
          'width': 60,
          'height': 60,
          'padding': 5
        }
      },
      {
        selector: 'node.center',
        style: {
          'background-color': '#667eea',
          'color': '#fff',
          'width': 80,
          'height': 80,
          'font-weight': 'bold'
        }
      },
      {
        selector: 'node.smoking-status',
        style: {
          'background-color': '#f59e0b',
          'color': '#fff',
          'width': 70,
          'height': 70,
          'font-weight': 'bold'
        }
      },
      {
        selector: 'node.patient',
        style: {
          'background-color': '#10b981',
          'color': '#fff',
          'width': 50,
          'height': 50,
          'font-size': 10
        }
      },
      {
        selector: 'edge',
        style: {
          'line-color': '#ccc',
          'target-arrow-color': '#ccc',
          'target-arrow-shape': 'triangle'
        }
      }
    ],
    layout: {
      name: 'concentric',
      animate: true,
      animationDuration: 1000,
      concentric: function(node) {
        if (node.data('id') === 'center') return 3;
        if (node.hasClass('smoking-status')) return 2;
        return 1;
      },
      levelWidth: function(nodes) {
        return 200;
      }
    }
  });
</script>

{% endblock %}